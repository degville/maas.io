<h1 id="maas-troubleshooting">MAAS Troubleshooting</h1>
<p>Some parts of MAAS may still be a little confusing, and sometimes you might be trying to do things that are just plain impossible. This section covers some of the most commonly encountered problems and tries its best to make them gone.</p>
<blockquote>
<dl>
<dt>depth</dt>
<dd><p>1</p>
</dd>
<dt>local</dt>
<dd>
</dd>
</dl>
</blockquote>
<h2 id="nodes-hang-on-commissioning">Nodes hang on &quot;Commissioning&quot;</h2>
<h3 id="possible-cause-timing-issues">Possible Cause: Timing issues</h3>
<p>Various parts of MAAS rely on OAuth to negotiate a connection to nodes. If the current time reported by the hardware clock on your node differs significantly from that on the MAAS server, the connection will not be made.</p>
<p><strong>SOLUTION:</strong> Check that the hardware clocks are consistent, and if necessary, adjust them. This can usually be done from within the system BIOS, without needing to install an OS</p>
<h3 id="possible-cause-network-drivers">Possible Cause: Network drivers</h3>
<p>Sometimes the hardware can boot from PXE, but fail to load correct drivers when booting the received image. This is sometimes the case when no open source drivers are available for the network hardware.</p>
<p><strong>SOLUTION:</strong> The best fix for this problem is to install a Linux-friendly network adapter. It <em>is</em> theoretically possible to modify the boot image to include proprietary drivers, but it is not a straightforward task.</p>
<h2 id="nodes-fail-to-pxe-boot">Nodes fail to PXE boot</h2>
<h3 id="possible-cause-using-an-incorrectly-configured-vm">Possible Cause: Using an incorrectly configured VM</h3>
<p>Some Virtual Machine setups include emulation of network hardware that does not support PXE booting, and in most setups, you will need to explicitly set up the VM to boot via PXE.</p>
<p><strong>SOLUTION</strong>: Consult the VM docs for details of PXE booting.</p>
<h3 id="possible-cause-dhcp-conflict">Possible Cause: DHCP conflict</h3>
<p>If you are using MAAS in a setup with an existing DHCP, <em>DO NOT SET UP THE MAAS DHCP SERVER</em> as this will cause no end of confusion to the rest of your network and most likely won't discover any nodes either.</p>
<p><strong>SOLUTION</strong>: You will need to configure your existing DHCP server to point to the MAAS server.</p>
<h2 id="cant-log-in-to-node">Can't log in to node</h2>
<p>Sometimes you may wish to login directly to a node on your system. If you have set up Juju and MAAS, the attached nodes will automatically receive existing ssh keys and sets up ssh on the node to authenticate via key, so you can just login with no password from the server. There is also an option in the MAAS web interface to add new ssh keys to the nodes (via Preferences in the drop down menu which appears when clicking your username in the top-right of the page).</p>
<h2 id="forgot-maas-superuser-password">Forgot MAAS superuser password</h2>
<p>As long as you have sudo privileges, this is not a disaster. You can use the <code>maas</code> command to change the password for the MAAS superuser on the MAAS server:</p>
<blockquote>
<p><code>sudo maas changepassword root</code></p>
</blockquote>
<h2 id="need-to-reconfigure-server-ip-address">Need to reconfigure server IP address</h2>
<p>If you made a mistake during setup or you just need to reconfigure your MAAS server, you can simply run the setup again:</p>
<blockquote>
<p><code>sudo dpkg-reconfigure maas-region-controller</code></p>
</blockquote>
<h2 id="cant-find-maas-webpage">Can't find MAAS webpage</h2>
<p>The default webpage is located at <code>http://&lt;hostname&gt;/MAAS/</code>. If you can't access it, there are a few things to try:</p>
<blockquote>
<ol>
<li>Check that the webserver is running - By default the web interface uses Apache, which runs under the service name <em>apache2</em>. To check it, on the MAAS server box you can run <code>sudo /etc/init.d/apache2 status</code>.</li>
<li>Check that the hostname is correct - It may seem obvious, but check that the hostname is being resolved properly. Try running a browser (even a text mode one like lynx) on the same box as the MAAS server and navigating to the page. If that doesn't work, try <code>http://127.0.0.1/MAAS/</code>, which will always point at the local server.</li>
<li>If you are still getting &quot;404 - Page not found&quot; errors, check that the MAAS web interface has been installed in the right place. There should be a file present called /usr/share/maas/maas/urls.py</li>
</ol>
</blockquote>
<h2 id="debugging-ephemeral-image">Debugging ephemeral image</h2>
<h3 id="backdoor-add-a-login-to-ephemeral-images">Backdoor (add a login) to ephemeral images</h3>
<p>If you cannot login to an instance, you might have to &quot;backdoor it&quot; in order to see what is going wrong. Scott Moser wrote a simple utility that injects a user and password into an image. Here's how to add a 'backdoor' user with a password to your images:</p>
<pre><code>sudo apt-get install --assume-yes bzr
bzr branch lp:~maas-maintainers/maas/backdoor-image backdoor-image

imgs=$(echo /var/lib/maas/boot-resources/*/*/*/*/*/*/root-image)
for img in $imgs; do
    [ -f &quot;$img.dist&quot; ] || sudo cp -a --sparse=always $img $img.dist
done

for img in $imgs; do
    sudo ./backdoor-image/backdoor-image -v --user=backdoor --password-auth --password=ubuntu $img
done</code></pre>
<h3 id="inside-the-ephemeral-image">Inside the ephemeral image</h3>
<p>Important files for debugging (Someone is likely to ask you for these things to help debug):</p>
<pre><code>/var/log/cloud-init.log
/var/log/boot.log
/var/log/cloud-init-output.log</code></pre>
<p>After enlistment or commissioning, the user-data from maas instructs the system to power off. To stop that from happening, you can just create a file in /tmp:</p>
<pre><code>touch /tmp/block-poweroff</code></pre>
<h3 id="maas-credentials">MAAS credentials</h3>
<p>MAAS credentials can be found in 2 places:</p>
<ol>
<li><p>from the cmdline you'll see a <code>url=</code> or <code>cloud-config-url=</code> parameter. You can get the cloud-config from that url, which will have credentials:</p>
<pre><code>$ sed -n &#39;s,.*url=\([^ ]*\).*,\1,p&#39; /proc/cmdline
http://10.55.60.194/MAAS/metadata/latest/enlist-preseed/?op=get_enlist_preseed</code></pre></li>
<li><p>from <code>/etc/cloud/cloud.cfg.d/91_kernel_cmdline_url</code>. The file was pulled from <code>url=</code> parameter by cloud-init:</p>
<pre><code>$ sudo cat /etc/cloud/cloud.cfg.d/91_kernel_cmdline</code></pre></li>
</ol>
<h3 id="maas-datasource">MAAS datasource</h3>
<p>The cloud-init datasource for MAAS can be invoked as a 'main' for debugging purposes. To do so, you need to know the url for the MAAS datasource and a config file that contains credentials:</p>
<pre><code>cfg=$(echo /etc/cloud/cloud.cfg.d/*_cmdline_url.cfg)
echo $cfg /etc/cloud/cloud.cfg.d/91_kernel_cmdline_url.cfg</code></pre>
<p>Now get the metadata_url from there:</p>
<pre><code>url=$(sudo awk &#39;$1 == &quot;metadata_url:&quot; { print $2 }&#39; $cfg)
echo $url http://10.55.60.194/MAAS/metadata/enlist</code></pre>
<p>Invoke the client /usr/share/pyshared/cloudinit/sources/DataSourceMAAS.py The client has --help Usage also, but here is an example of how to use it:</p>
<pre><code>$ maasds=&quot;/usr/share/pyshared/cloudinit/sources/DataSourceMAAS.py&quot;
$ sudo python $maasds --config=$cfg get $url
== http://10.55.60.194/MAAS/metadata/enlist ==
2012-03-01
latest
$ sudo python $maasds --config=$cfg get $url/latest/meta-data/local-hostname
maas-enlisting-node</code></pre>
